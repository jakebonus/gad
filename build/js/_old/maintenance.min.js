$(function(){var j=$("#txt-delpassword");var c=$("#dt_all_transaction"),d=$("select#tr_lot_no"),f=$("select#m_name"),b=null;$(".input-daterange").datepicker({todayBtn:"linked",format:"yyyy-mm-dd",});d.select2({placeholder:"ALL",allowClear:true});f.select2({placeholder:"ALL",allowClear:true});function g(o,n){c.dataTable().fnClearTable();c.dataTable().fnDestroy();var m=c.DataTable({ajax:{type:"GET",url:o,data:n,dataSrc:""},columns:[{data:function(p){return p.tr_id}},{data:function(p){return p.tr_rs_no}},{data:function(p){return p.m_name}},{data:function(p){return p.tr_lot_no}},{data:function(p){return p.t_package}},{data:function(p){return p.tr_qty}},{data:function(p){return p.tr_location}},{data:function(p){return p.recvby}},{data:function(p){return p.tr_brgy}},{data:function(p){return p.addedby}},{data:function(p){return p.addeddate}}],dom:'<"wrapper"Bfit>',info:false,order:[[0,"desc"]],scrollY:400,scrollX:true,scrollCollapse:true,paging:false,buttons:[{text:"",extend:"excelHtml5",titleAttr:"Export Excel",className:"fa fa-download",customize:function(q){var p=q.xl.worksheets["sheet1.xml"];$('row c[r^="C"]',p).attr("s","2")}},{text:"",extend:"print",titleAttr:"Print",className:"fa fa-print",exportOptions:{columns:":visible"},}],fnCreatedRow:function(r,q,p){$(r).attr("data-tr_id",q.tr_id);$(r).attr("data-tr_lot_no",q.tr_lot_no);$(r).attr("data-m_name",q.m_name);$(r).attr("data-t_package",q.t_package);$(r).attr("data-tr_qty",q.tr_qty);$(r).attr("data-addedby",q.addedby);$(r).attr("data-addeddate",q.addeddate);$(r).attr("data-tr_brgy",q.tr_brgy);$(r).attr("data-tr_location",q.tr_location);$(r).attr("data-recvby",q.recvby);$(r).attr("data-tr_rs_no",q.tr_rs_no);$(r).attr("data-remarks",q.remarks)},fnInitComplete:function(q,p){$(".alert-info .glyphicon-remove").trigger("click")},fnRowCallback:function(r,q,p){$(r).addClass(q.remarks);return r}})}$("#btn_reset").click(function(){d.val(null).trigger("change");$("a.btn.fa-refresh").trigger("click")});$("#btn_search").click(function(){$(".alert-info .glyphicon-remove").trigger("click");k("Processing","Please wait..","info",9999999);var n=base_url+"maintenance/ajax_get_all_transaction";var m=$("#frm_search").serializeObject();c.removeClass("hidden");$(".no-record").addClass("hidden");g(n,m);return false});$("body").delegate("#dt_all_transaction tbody tr","click",function(){var m="";b=$(this).data("tr_id");$("#mdl-trans-del").modal("show");$("#btn_mdelete").attr("data-tr_id",b);m+="<strong>Ris No:</strong> "+$(this).data("tr_rs_no")+" <br><br><strong>Medicine:<br></strong> "+$(this).data("m_name")+" <br><br><strong>Package: </strong> "+$(this).data("t_package")+" <br><strong>Qty: </strong> "+$(this).data("tr_qty")+" <br><strong>Lot no:</strong> "+$(this).data("tr_lot_no")+" <br><strong>Location:</strong> "+$(this).data("tr_location")+" <br>";if($(this).data("remarks")=="color-d"){m+="<strong>Received by:</strong> "+$(this).data("recvby")+" <br><strong>Barangay:</strong> "+$(this).data("tr_brgy")+" <br>"}m+="<strong>Added by:</strong> "+$(this).data("addedby")+" <br><br><strong>Added datetime:</strong> "+$(this).data("addeddate");$("#mdl-trans-del .modal-body p:eq(1)").html(m);$("#mdl-trans-del .modal-title").text("Delete - "+b)});$("body").delegate("#mdl-trans-del #btn_mdelete","click",function(){if(j.val()==""){if($("body .ui-pnotify > .alert-info").length==0){k("Required","Please enter your password","info",2000)}return false}if(b!=null){var m={tr_id:b,delpassword:j.val()};$.ajax({dataType:"json",type:"post",url:base_url+"maintenance/ajax_tdelete",data:m,beforeSend:function(){k("Please wait","Deleting.....","info",999999)},success:function(n){if(n.status=="yes"){$(".alert-info .glyphicon-remove").trigger("click");k("Success!",n.content,"success",2000);$("#btn_search").trigger("click");b=null;j.val("");$("#mdl-trans-del").modal("hide")}else{$(".alert-info .glyphicon-remove").trigger("click");k("Failed!",n.content,"",2000);j.val("")}},error:function(o,n){$(".alert-info .glyphicon-remove").trigger("click");b=null;k("Error!","Connection problems occurred... Unable to connect to the Internet! The Internet connection has been lost.","error",5000);j.val("");$("#mdl-trans-del").modal("hide")}})}return false});$("select#tr_risno").change(function(){if($(this).val()=="D-"){$(".lbl-brgy").removeClass("hidden")}else{$(".lbl-brgy").addClass("hidden")}});$("body").delegate("#btn_reset","click",function(){f.val(null).trigger("change");$("#start, #end, #tr_risno, #t_risno").val("");return false});$("#mdl-trans-del").on("shown.bs.modal",function(){j.val("").focus();$(document).on("keypress","#txt-delpassword",function(m){if(m.which=="13"){$("#btn_mdelete").trigger("click")}})});$.fn.serializeObject=function(){var m={};var n=this.serializeArray();$.each(n,function(){if(m[this.name]){if(!m[this.name].push){m[this.name]=[m[this.name]]}m[this.name].push(this.value||"")}else{m[this.name]=this.value||""}});return m};function h(q,r,n,p){var o="",m=new XMLHttpRequest();m.open("GET",q,true);m.onreadystatechange=function(){if(this.readyState==4&&this.status==200){var s=JSON.parse(this.responseText);$(r).detach();o+='<option value="">ALL</option>';if(p==1){o+="<option value='N/A'>N/A</option>"}if(p==3){for(i=0;i<s.length;i++){o+="<option value='"+s[i].m_id+"'>"+s[i].m_name+"</option>"}}else{for(i=0;i<s.length;i++){o+="<option value='"+s[i].value+"'>"+s[i].value+"</option>"}}$(n).html(o);$(n).prop("disabled",false)}};m.send()}h(base_url+"report/ajax_get_medicine_stockcard","#m_name option","#m_name",3);h(base_url+"maintenance/ajax_get_all_trans_brgy","#tr_brgy option","#tr_brgy",0);function e(n,p){var o="",m="";if(n>0){m="and"}if(p>1){o=m+" "+p+" PCS"}else{if(p>0){o=m+" "+p+" PC"}}return o}function l(){var m="";if($("#tr_risno").val()=="D-"){m+="2,"}if($("#tr_lot_no").val()==""){m+="1,"}m=m.split(",").map(Number);m.splice($.inArray(0,m),1);return m}function a(o,m){var n="";if(o>1){n=o+" "+m+"ES"}else{if(o>0){n=o+" "+m}}return n}function k(o,p,m,n){new PNotify({title:o,text:p,styling:"bootstrap3",type:m,delay:n})}});