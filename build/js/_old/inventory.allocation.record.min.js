$(function(){$(window).on("blur focus",function(g){var f=$(this).data("prevType");if(f!=g.type){switch(g.type){case"focus":c.ajax.reload()}}$(this).data("prevType",g.type)});e("Processing","Please wait..","info",999999);function b(g,h,f){var j=new XMLHttpRequest();j.open("GET",g,true);j.onreadystatechange=function(){if(this.readyState==4&&this.status==200){var k=JSON.parse(this.responseText);$(h).detach();$(f).append('<option value="">ALL</option>');for(i=0;i<k.length;i++){$(f).append("<option value='"+k[i].value+"'>"+k[i].value+"</option>")}$(f).prop("disabled",false)}};j.send()}b(base_url+"inventory/ajax_get_risno?str=A-","#col0_filter option","#col0_filter");b(base_url+"inventory/ajax_get_location?str=A-","#col1_filter option, #col2_filter option","#col1_filter, #col2_filter");b(base_url+"inventory/ajax_get_fund?str=A-","#col3_filter option","#col3_filter");b(base_url+"inventory/ajax_get_program?str=A-","#col4_filter option","#col4_filter");$("select#col0_filter").select2({placeholder:"Select RIS NO",allowClear:true});var a=null;var c=$("#dt_dispense_record").DataTable({ajax:{url:base_url+"inventory/ajax_record_allocation",dataSrc:""},columns:[{data:"tr_rs_no"},{data:"SOURCE"},{data:"DESTINATION"},{data:"tr_funding"},{data:"tr_program"}],fnCreatedRow:function(g,f,h){$(g).attr("data-tr_location",f.SOURCE);$(g).attr("data-tr_funding",f.tr_funding);$(g).attr("data-tr_program",f.tr_program);$(g).attr("data-tr_destination",f.DESTINATION);$(g).attr("data-tr_receivedby",f.RECEIVED_BY);$(g).attr("data-tr_allocateby",f.ALLOCATE_BY);$(g).attr("data-tr_date",f.tr_date);$(g).attr("data-tr_rs_no",f.tr_rs_no)},dom:'<"wrapper"Bfit>',info:false,order:[[0,"desc"]],scrollY:400,scrollX:true,scrollCollapse:true,paging:false,buttons:[{extend:"excelHtml5",customize:function(g){var f=g.xl.worksheets["sheet1.xml"];$('row c[r^="C"]',f).attr("s","2")}},{extend:"print",exportOptions:{columns:":visible"},},],order:[[0,"desc"]],deferRender:true,scrollY:400,scrollCollapse:true,scroller:true,scrollX:true,initComplete:function(){$(".alert-info .glyphicon-remove").trigger("click")}});$("#dt_dispense_record tbody").on("click","tr",function(){if($(this).hasClass("selected")){$(this).removeClass("selected")}else{c.$("tr.selected").removeClass("selected");$(this).addClass("selected")}var f=$(this).attr("data-tr_rs_no");if($("body .ui-pnotify > .alert-info").length==0){if(typeof f!==typeof undefined&&f!==false){$("#tbl_print_preview tbody").empty();$("#mdl-print-draft .modal-body p:eq(0)").text($(this).data("tr_location"));$("#mdl-print-draft .modal-body p:eq(1)").text($(this).data("tr_funding"));$("#mdl-print-draft .modal-body p:eq(2)").text($(this).data("tr_program"));$("#mdl-print-draft .modal-body p:eq(3)").text($(this).data("tr_destination"));$("#mdl-print-draft .modal-body p:eq(4)").text($(this).data("tr_receivedby"));$("#mdl-print-draft .modal-body p:eq(5)").text($(this).data("tr_allocateby"));$("#mdl-print-draft .modal-body p:eq(6)").text($(this).data("tr_date"));$("#mdl-print-draft .modal-body p:eq(7)").text($(this).data("tr_rs_no"));var g={tr_rs_no:$(this).data("tr_rs_no"),tr_location:$(this).data("tr_location")};$.ajax({dataType:"json",type:"GET",url:base_url+"inventory/ajax_search_record",data:g,beforeSend:function(){e("Processing","Please wait..","info",999999)},success:function(h){$(".alert-info .glyphicon-remove").trigger("click");a=h;$.each(h,function(j,k){$("#tbl_print_preview tbody").append("<tr><td>"+k.m_name+" ["+k.tr_lot_no+"]</td><td>"+k.tr_rs_no+"</td><td>"+k.tr_pcsper_set+" ["+k.tr_unit+']</td><td class="text-right">'+k.tr_qty+"</td></tr>")});$("#mdl-print-draft").modal("show")},error:function(h,k,j){e("Error!","Connection problems occurred... Unable to connect to the Internet! The Internet connection has been lost.","error",1500)}})}}return false});$("body").delegate("#btn_record_print","click",function(){$("#tbl-print tr.print").empty();$.each(a,function(f,g){$("#tbl-print tr.title").after("<tr class='print'><td style='color:"+g.remarks+"'>&nbsp; "+g.tr_expiration_date+"</td><td colspan='2'> &nbsp;"+g.m_name+" ["+g.tr_lot_no+"]</td><td>&nbsp; "+g.tr_pcsper_set+" ["+g.tr_unit+"]</td><td class='text-right'>"+g.tr_qty+"&nbsp;</td><td colspan='2'></td></tr>")});$("#tbl-print span.source").text($("#mdl-print-draft .modal-body p:eq(0)").text());$("#tbl-print span.destination").text($("#mdl-print-draft .modal-body p:eq(3)").text());$("#tbl-print span.date").text($("#mdl-print-draft .modal-body p:eq(6)").text());$("#tbl-print span.tr_allocateby").text($("#mdl-print-draft .modal-body p:eq(5)").text());$("#tbl-print .p_risno").text($("#mdl-print-draft .modal-body p:eq(7)").text());$("#tbl-print span.tr_recvby").text($("#mdl-print-draft .modal-body p:eq(4)").text());$("#mdl-recordprint").modal("show")});$(".column_filter").on("keyup click change",function(){d($(this).parents("div").attr("data-column"))});function d(f){$("#dt_dispense_record").DataTable().column(f).search($("#col"+f+"_filter").val()).draw()}$("body").delegate("#btn_cancel","click",function(){$("#frm_sdispense").data("formValidation").resetForm();$("#frm_sdispense")[0].reset();$("#print-report, ._print").addClass("hidden")});function e(j,g,f,h){new PNotify({title:j,text:g,styling:"bootstrap3",type:f,delay:h})}$("body").delegate("a._refresh","click",function(){c.ajax.reload();$("#col0_filter, .filter select").val(null).trigger("change")})});function printContent(b){var a=document.getElementById(b);newWin=window.open("");newWin.document.write("<html><head><style>table{width:100%}b, strong {font-weight:700}table {border-collapse:collapse;}table td, table th{ border: 1px solid black; text-align:left;}tr.group{background-color: #d8d8d8;margin-top:10px;padding-top:10px} .img-logo {position:absolute;left:calc(50% - 200px);top:11px}.th-head{position:relative;padding:10px 0}p.p-version{position:absolute;top:0;right:3px;font-size:9px}.version{position:relative}.p_risno{position:absolute;right:6px;top:3px}.text-right{text-align:right}</style>");newWin.document.write('</head><body onload="window.print()">');newWin.document.write(a.outerHTML);newWin.document.write("</body>");newWin.document.write("</html>");newWin.print();newWin.close()};