$(function(){$(window).on("blur focus",function(f){var g=$(this).data("prevType");if(g!=f.type){switch(f.type){case"focus":c.ajax.reload()}}$(this).data("prevType",f.type)});a("Processing","Please wait..","info",999999);function e(g,f,h){var j=new XMLHttpRequest();j.open("GET",g,true);j.onreadystatechange=function(){if(this.readyState==4&&this.status==200){var k=JSON.parse(this.responseText);$(f).detach();$(h).append('<option value="">ALL</option>');for(i=0;i<k.length;i++){$(h).append("<option value='"+k[i].value+"'>"+k[i].value+"</option>")}$(h).prop("disabled",false)}};j.send()}e(base_url+"inventory/ajax_get_d_risno","#col0_filter option","#col0_filter");e(base_url+"inventory/ajax_get_d_location","#col1_filter option","#col1_filter");e(base_url+"inventory/ajax_get_d_destination","#col2_filter option","#col2_filter");e(base_url+"inventory/ajax_get_d_fund","#col3_filter option","#col3_filter");e(base_url+"inventory/ajax_get_d_program","#col4_filter option","#col4_filter");$("select#col0_filter").select2({placeholder:"Select RIS NO",allowClear:true});$("select#col2_filter").select2({placeholder:"Select Destination",allowClear:true});var d=null;var c=$("#dt_dispense_record").DataTable({ajax:{url:base_url+"inventory/ajax_record_dispense",dataSrc:""},columns:[{data:"tr_rs_no"},{data:"tr_location"},{data:"DESTINATION"},{data:"tr_funding"},{data:"tr_program"}],fnCreatedRow:function(g,h,f){$(g).attr("data-tr_location",h.tr_location);$(g).attr("data-tr_funding",h.tr_funding);$(g).attr("data-tr_program",h.tr_program);$(g).attr("data-tr_fc_id",h.tr_fc_id);$(g).attr("data-tr_sc_id",h.tr_sc_id);$(g).attr("data-name",h.name);$(g).attr("data-tr_type",h.tr_type);$(g).attr("data-tr_brgy",h.tr_brgy);$(g).attr("data-tr_by",h.tr_by);$(g).attr("data-tr_date",h.tr_date);$(g).attr("data-tr_rs_no",h.tr_rs_no)},dom:'<"wrapper"Bfit>',info:false,order:[[0,"desc"]],scrollY:400,scrollX:true,scrollCollapse:true,paging:false,buttons:[{extend:"excelHtml5",customize:function(f){var g=f.xl.worksheets["sheet1.xml"];$('row c[r^="C"]',g).attr("s","2")}},{extend:"print",exportOptions:{columns:":visible"},},],order:[[0,"desc"]],deferRender:true,scrollY:400,scrollCollapse:true,scroller:true,scrollX:true,initComplete:function(){$(".alert-info .glyphicon-remove").trigger("click")}});$("#dt_dispense_record tbody").on("click","tr",function(){if($(this).hasClass("selected")){$(this).removeClass("selected")}else{c.$("tr.selected").removeClass("selected");$(this).addClass("selected")}var g=$(this).attr("data-tr_rs_no");if($("body .ui-pnotify > .alert-info").length==0){if(typeof g!==typeof undefined&&g!==false){$("#tbl_print_preview tbody").empty();$("#mdl-print-draft .modal-body p:eq(3)").text("");$("#mdl-print-draft .modal-body p:eq(4)").text("");$("#mdl-print-draft .modal-body p:eq(0)").text($(this).data("tr_location"));$("#mdl-print-draft .modal-body p:eq(1)").text($(this).data("tr_funding"));$("#mdl-print-draft .modal-body p:eq(2)").text($(this).data("tr_program"));$("#mdl-print-draft .modal-body p:eq(3)").text($(this).data("tr_fc_id"));$("#mdl-print-draft .modal-body p:eq(4)").text($(this).data("tr_sc_id"));$("#mdl-print-draft .modal-body p:eq(5)").text($(this).data("name"));$("#mdl-print-draft .modal-body p:eq(6)").text($(this).data("tr_type"));$("#mdl-print-draft .modal-body p:eq(7)").text($(this).data("tr_brgy"));$("#mdl-print-draft .modal-body p:eq(8)").text($(this).data("tr_by"));$("#mdl-print-draft .modal-body p:eq(9)").text($(this).data("tr_date"));$("#mdl-print-draft .modal-body p:eq(10)").text($(this).data("tr_rs_no"));var f={tr_rs_no:$(this).data("tr_rs_no"),tr_location:$(this).data("tr_location")};$.ajax({dataType:"json",type:"GET",url:base_url+"inventory/ajax_search_record",data:f,beforeSend:function(){a("Processing","Please wait..","info",999999)},success:function(h){$(".alert-info .glyphicon-remove").trigger("click");d=h;$.each(h,function(k,j){$("#tbl_print_preview tbody").append("<tr><td>"+j.m_name+" ["+j.tr_lot_no+"]</td><td>"+j.tr_rs_no+"</td><td>"+j.tr_pcsper_set+" ["+j.tr_unit+']</td><td class="text-right">'+j.tr_qty+"</td></tr>")});$("#mdl-print-draft").modal("show")},error:function(k,j,h){a("Error!","Connection problems occurred... Unable to connect to the Internet! The Internet connection has been lost.","error",1500)}})}}return false});$("body").delegate("#btn_record_print","click",function(){$("#tbl-print tr.print").empty();$.each(d,function(g,f){$("#tbl-print tr.title").after("<tr class='print'><td style='color:"+f.remarks+"'>&nbsp; "+f.tr_expiration_date+"</td><td colspan='2'> &nbsp;"+f.m_name+" ["+f.tr_lot_no+"]</td><td>&nbsp; "+f.tr_pcsper_set+" ["+f.tr_unit+"]</td><td class='text-right'>"+f.tr_qty+"&nbsp;</td><td colspan='2'></td></tr>")});$("#tbl-print span.source").text($("#mdl-print-draft .modal-body p:eq(0)").text());$("#tbl-print span.destination").text($("#mdl-print-draft .modal-body p:eq(5)").text());$("#tbl-print span.date").text($("#mdl-print-draft .modal-body p:eq(9)").text());$("#tbl-print span.date").text($("#mdl-print-draft .modal-body p:eq(9)").text());$("#tbl-print span.tr_allocateby").text($("#mdl-print-draft .modal-body p:eq(8)").text());$("#tbl-print .p_risno").text($("#mdl-print-draft .modal-body p:eq(10)").text());$("#mdl-recordprint").modal("show")});$(".column_filter").on("keyup click change",function(){b($(this).parents("div").attr("data-column"))});function b(f){$("#dt_dispense_record").DataTable().column(f).search($("#col"+f+"_filter").val()).draw()}$("body").delegate("#btn_cancel","click",function(){$("#frm_sdispense").data("formValidation").resetForm();$("#frm_sdispense")[0].reset();$("#print-report, ._print").addClass("hidden")});function a(g,j,f,h){new PNotify({title:g,text:j,styling:"bootstrap3",type:f,delay:h})}$("body").delegate("a._refresh","click",function(){c.ajax.reload();$("#col0_filter, .filter select").val(null).trigger("change")})});function printContent(b){var a=document.getElementById(b);newWin=window.open("");newWin.document.write("<html><head><style>table{width:100%}b, strong {font-weight:700}table {border-collapse:collapse;}table td, table th{ border: 1px solid black; text-align:left;}tr.group{background-color: #d8d8d8;margin-top:10px;padding-top:10px} .img-logo {position:absolute;left:calc(50% - 200px);top:11px}.th-head{position:relative;padding:10px 0}p.p-version{position:absolute;top:0;right:3px;font-size:9px}.version{position:relative}.p_risno{position:absolute;right:6px;top:3px}.text-right{text-align:right}</style>");newWin.document.write('</head><body onload="window.print()">');newWin.document.write(a.outerHTML);newWin.document.write("</body>");newWin.document.write("</html>");newWin.print();newWin.close()};