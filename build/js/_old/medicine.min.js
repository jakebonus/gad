$(function(){var c=null,b=$("#frm-medicine"),f=$("#dt_medicinelist");$(window).on("blur focus",function(h){var g=$(this).data("prevType");if(g!=h.type){switch(h.type){case"focus":a.ajax.reload()}}$(this).data("prevType",h.type)});e("Processing","Please wait..","info",999999);$("#m_dosage_form").change(function(){var g=$(this).find("option:selected");if(g.val()=="PC"){$("#m_therapeutic_use option").attr("disabled","disabled");$("#m_therapeutic_use option[value='MEDICAL SUPPLIES']").removeAttr("disabled");$("#m_therapeutic_use option[value='MEDICAL SUPPLIES']").attr("selected","selected")}else{$("#m_therapeutic_use option").removeAttr("disabled")}});f.dataTable().fnClearTable();f.dataTable().fnDestroy();var a=f.DataTable({ajax:{url:base_url+"medicine/ajax_get_allmedicine",dataSrc:""},columns:[{data:"m_id"},{data:"m_name"},{data:"m_dosage_form"},{data:"m_therapeutic_use"},{data:"m_set"},{data:"m_pcsper_set"}],fnCreatedRow:function(h,g,i){$(h).attr("data-m_id",g.m_id);$(h).attr("data-m_name",g.m_name);$(h).attr("data-m_dosage_form",g.m_dosage_form);$(h).attr("data-m_therapeutic_use",g.m_therapeutic_use);$(h).attr("data-m_set",g.m_set);$(h).attr("data-m_pcsper_set",g.m_pcsper_set)},columnDefs:[{targets:[0],visible:false,searchable:true,}],dom:'<"wrapper"Bfit>',info:false,order:[[0,"desc"]],scrollY:380,scrollX:true,scrollCollapse:true,paging:false,buttons:[{text:"",titleAttr:"Add",className:"fa fa-plus m-add"},{text:"",extend:"excelHtml5",titleAttr:"Export Excel",className:"fa fa-download",customize:function(h){var g=h.xl.worksheets["sheet1.xml"];$('row c[r^="C"]',g).attr("s","2")}},{text:"",extend:"print",titleAttr:"Print",className:"fa fa-print",exportOptions:{columns:":visible"},},{text:"",titleAttr:"Refresh",className:"fa fa-refresh",action:function(h,j,g,i){d("r")}}],fnInitComplete:function(h,g){$(".alert-info .glyphicon-remove").trigger("click")}});b.formValidation({framework:"bootstrap",button:{selector:"#btn-frm-medicine",disabled:"disabled"},icon:null,fields:{m_name:{validators:{notEmpty:{message:"The name is required"},regexp:{regexp:/^[a-zA-Z0-9 .,-_+]+$/}}},m_dosage_form:{validators:{notEmpty:{message:"The dosage form is required"},}},m_therapeutic_use:{validators:{notEmpty:{message:"The therapeutic use is required"},}},m_set:{validators:{notEmpty:{message:"The set is required"},}},m_pcsper_set:{validators:{integer:{message:"The value is not number"}}}}}).on("success.form.fv",function(i){i.preventDefault();var g=$(i.target),h=g.data("formValidation");if(c==null){$.ajax({dataType:"json",type:"post",url:base_url+"medicine/ajax_msave",data:b.serialize(),beforeSend:function(){e("Processing","Please wait..","info")},success:function(j){if(j.status=="yes"){e("Success!",j.content,"success");d("r")}else{e("Failed!",j.content,"");d("r")}},error:function(l,k,j){if(l.responseText.indexOf("1062")!=-1){e("Duplicate entry!","This medicine is already exists!, Please check.","error")}else{e("Error!","Connection problems occurred... Unable to connect to the Internet! The Internet connection has been lost.","error")}d("r")}});return false}else{$.ajax({dataType:"json",type:"post",url:base_url+"medicine/ajax_medit",data:b.serialize()+"&m_id="+c,success:function(j){if(j.status=="yes"){e("Success!",j.content,"success");d("r")}else{e("Failed!",j.content,"");d("r")}},error:function(k,j){e("Error!","Connection problems occurred... Unable to connect to the Internet! The Internet connection has been lost.","error");d("r")}});return false}});$("#dt_medicinelist tbody").on("click","tr",function(){b.data("formValidation").resetForm();$("#btn-frm-medicine").prop({className:"buttonNext btn btn-warning"});$("h2.title").text("Edit");c=$(this).data("m_id");$("#frm-medicine #m_name").val($(this).data("m_name"));$("#frm-medicine #m_dosage_form").val($(this).data("m_dosage_form"));$("#frm-medicine #m_therapeutic_use").val($(this).data("m_therapeutic_use"));$("#frm-medicine #m_set").val($(this).data("m_set"));$("#frm-medicine #m_pcsper_set").val($(this).data("m_pcsper_set"));$(".bs-delete-modal-sm .modal-body p:eq(1)").html("<strong>"+$(this).data("m_name")+" "+$(this).data("m_dosage_form")+"</strong>");if($(".actionBar").find("button").length<=2){$("#btn_reset").after('<button type="button" id="btn_delete" class="buttonPrevious btn btn-danger" data-toggle="modal" data-target=".bs-delete-modal-sm">Delete</button>')}});$(".m-add, #btn_reset").click(function(){d("")});$("body").delegate("#btn_mdelete","click",function(){$.ajax({dataType:"json",type:"post",url:base_url+"medicine/ajax_mdelete",data:"m_id="+c,success:function(g){if(g.status=="yes"){e("Success!",g.content,"success");d("r")}else{e("Failed!",g.content,"");d("r")}},error:function(h,g){e("Error!","Connection problems occurred... Unable to connect to the Internet! The Internet connection has been lost.","error");d("r")}});return false});$("#dt_medicinelist tbody").on("click","tr",function(){if($(this).hasClass("selected")){$(this).removeClass("selected")}else{a.$("tr.selected").removeClass("selected");$(this).addClass("selected")}});function e(g,h,i){$(".form-group").removeClass("has-success");new PNotify({title:g,text:h,styling:"bootstrap3",type:i,delay:1500})}function d(g){b.data("formValidation").resetForm();c=null;$("h2.title").text("Add");b[0].reset();$("#btn-frm-medicine").prop({className:"buttonNext btn btn-success"});$("#btn_delete").remove();if(g=="r"){a.search("").columns().search("").draw();a.ajax.reload()}}});